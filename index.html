<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title></title>
<link type='text/css' href='style.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">
   <script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [['$','$']],
         processEscapes: true
       }
     });
   </script>
   <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
   </script>
   
</head>
<body>
<div id="content-container">
<div id="toc">
<div id="page-toc">
</div>
<div id="toc-footer"><ul><li><a href="https://github.com/melisgl/mgl-pax">[generated by MGL-PAX]</a></li></ul></div>
</div>
<div id="content">
<p><a id="x-28TZ-UTILITIES-3A-40INDEX-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@INDEX%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION" title="Overview">&#8594;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8634;</a></span></span></p>

<h1><a href="index.html"><code>@INDEX</code></a></h1>

<h2>Table of Contents</h2>

<ul>
<li><a href="#TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION" title="Overview">1 Overview</a></li>
<li><a href="#TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION" title="Access to secrets">2 Access to secrets</a></li>
<li><a href="#TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION" title="Cached variables">3 Cached variables</a></li>
<li><a href="#TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION" title="Time tools">4 Time tools</a></li>
<li><a href="#TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION" title="Alist utilities">5 Alist utilities</a></li>
<li><a href="#TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION" title="Anaphoric macros">6 Anaphoric macros</a></li>
<li><a href="#TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION" title="Named objects">7 Named objects</a></li>
<li><a href="#TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@SAVE-LOAD`">8 <code>@SAVE-LOAD</code></a></li>
<li><a href="#TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@JS-TOOLS`">9 <code>@JS-TOOLS</code></a></li>
<li><a href="#TZ-UTILITIES:@DEBUGGER-HOOKS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@DEBUGGER-HOOKS`">10 <code>@DEBUGGER-HOOKS</code></a></li>
</ul>

<h6>[in package TZ-UTILITIES]</h6>

<p><a id="x-28TZ-UTILITIES-3A-40OVERVIEW-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION" title="Access to secrets">&#8594;</a> <a href="#TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION" title="Overview">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION">1 Overview</a></h2>

<p>This is a random collection of utilities that were not yet extracted to separate
systems.</p>

<p><a id="x-28TZ-UTILITIES-3A-40AUTHINFO-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@OVERVIEW%20MGL-PAX:SECTION" title="Overview">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION" title="Cached variables">&#8594;</a> <a href="#TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION" title="Access to secrets">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION">2 Access to secrets</a></h2>

<p>Utilities to retrieve passwords from safer storage.</p>

<p>The idea is not to have passwords (and possibly related configuration objects -
names, etc) in the code, but elsewhere, and ask for them when needed in a simple way.</p>

<p>Two backends are in place: authinfo files (internally implemented, to be
deprecated), and secret service API, using <a href="https://github.com/zellerin/secret-service/" >SECRET-SERVICE</a> implementation.</p>

<p>In addition this provides caching of the credentials</p>

<p>TODO: is caching still needed/useful?</p>

<p>TODO: Packages - link to documentation or source github?</p>

<p><a id="x-28TZ-UTILITIES-3AGET-AUTHINFO-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:GET-AUTHINFO%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:GET-AUTHINFO%20FUNCTION" >GET-AUTHINFO</a></span></span> <span class="locative-args">MACHINE USERNAME</span></span></p>

<p>Get secret for machine <code>MACHINE</code> and login <code>USERNAME</code>.</p>

<p>Store already found secrets in a cache and try to retrieve from cache before
other storate is tried.</p>

<p>Raise condition <a href="#TZ-UTILITIES:SECRET-NOT-FOUND%20CONDITION" title="TZ-UTILITIES:SECRET-NOT-FOUND CONDITION"><code>SECRET-NOT-FOUND</code></a> if relevant secret is not found; it has
established restart <a href="http://www.lispworks.com/documentation/HyperSpec/Body/r_use_va.htm" title="USE-VALUE (MGL-PAX:CLHS RESTART)"><code>USE-VALUE</code></a> that sets the secret in cache as well.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AGET-AUTHINFO-BOTH-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:GET-AUTHINFO-BOTH%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:GET-AUTHINFO-BOTH%20FUNCTION" >GET-AUTHINFO-BOTH</a></span></span> <span class="locative-args">MACHINE</span></span></p>

<p>Get user and secret for <code>MACHINE</code>.</p>

<p>Store already found secrets in a cache and try to retrieve from cache before
other storage is tried.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-2AAUTHINFO-FILES-2A-20VARIABLE-29"></a>
<a id="TZ-UTILITIES:*AUTHINFO-FILES*%20VARIABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#TZ-UTILITIES:*AUTHINFO-FILES*%20VARIABLE" >*AUTHINFO-FILES*</a></span></span> <span class="locative-args">(&quot;~/.authinfo&quot;)</span></span></p>

<p>Authinfo files to search secrets in.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ASECRET-NOT-FOUND-20CONDITION-29"></a>
<a id="TZ-UTILITIES:SECRET-NOT-FOUND%20CONDITION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[condition]</span> <span class="reference-object"><a href="#TZ-UTILITIES:SECRET-NOT-FOUND%20CONDITION" >SECRET-NOT-FOUND</a></span></span> <span class="locative-args"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_seriou.htm" title="SERIOUS-CONDITION (MGL-PAX:CLHS CONDITION)">SERIOUS-CONDITION</a></span></span></p>

<p>Condition thrown when no relevant secret is found.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40CACHED-VARS-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@AUTHINFO%20MGL-PAX:SECTION" title="Access to secrets">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION" title="Time tools">&#8594;</a> <a href="#TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION" title="Cached variables">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION">3 Cached variables</a></h2>

<p>To prevent long loading times, allow variables to be initialized dynamically -
the initialing form is stored at load time, and evaluated when the form is
used.</p>

<p>The &quot;variable&quot; symbol is expanded to a form &quot;(read-cached symbol)&quot;.</p>

<p>Not that the illusion of VAR being really variable breaks when it is used in a
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm" title="LET (MGL-PAX:CLHS MGL-PAX:MACRO)"><code>LET</code></a> form. This turns out to be quite a serious problem.</p>

<p><a id="x-28TZ-UTILITIES-3ADEFINE-CACHED-VAR-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:DEFINE-CACHED-VAR%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:DEFINE-CACHED-VAR%20MGL-PAX:MACRO" >DEFINE-CACHED-VAR</a></span></span> <span class="locative-args">NAME VALUE &amp;OPTIONAL COMMENT</span></span></p>

<p>Define <code>NAME</code> as a symbol that is evaluated to <code>VALUE</code> first time it is used.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AFORGET-CACHED-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:FORGET-CACHED%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:FORGET-CACHED%20FUNCTION" >FORGET-CACHED</a></span></span> <span class="locative-args">VISIBLE-NAME</span></span></p>

<p>Forget value of cached variable, if it was already evaluated. This causes
re-evaluation next time it is used.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40TIME-TOOLS-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@CACHED-VARS%20MGL-PAX:SECTION" title="Cached variables">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION" title="Alist utilities">&#8594;</a> <a href="#TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION" title="Time tools">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION">4 Time tools</a></h2>

<p>Time related utilities. The baseline and convention is the <a href="#TZ-UTILITIES:LOCAL-TIME%20READTABLE" title="TZ-UTILITIES:LOCAL-TIME READTABLE"><code>LOCAL-TIME</code></a> package.</p>

<p><a id="x-28TZ-UTILITIES-3ATOMORROW-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:TOMORROW%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:TOMORROW%20FUNCTION" >TOMORROW</a></span></span> <span class="locative-args">&amp;OPTIONAL (N 1) (BASE (<code>NOW</code>))</span></span></p>

<p>Timestamp of Nth day in future (1 being tomorrow) 00:00.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-2AORG-TIME-FORMAT-2A-20VARIABLE-29"></a>
<a id="TZ-UTILITIES:*ORG-TIME-FORMAT*%20VARIABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#TZ-UTILITIES:*ORG-TIME-FORMAT*%20VARIABLE" >*ORG-TIME-FORMAT*</a></span></span> <span class="locative-args">(:YEAR &quot;-&quot; (:MONTH 2) &quot;-&quot; (:DAY 2) &quot; &quot; (:HOUR 2) &quot;:&quot; (:MIN 2) &quot; &quot;\
 :SHORT-WEEKDAY)</span></span></p>

<p>Format of timestamp used by Org mode.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ALOCAL-TIME-20READTABLE-29"></a>
<a id="TZ-UTILITIES:LOCAL-TIME%20READTABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[readtable]</span> <span class="reference-object"><a href="#TZ-UTILITIES:LOCAL-TIME%20READTABLE" >LOCAL-TIME</a></span></span></span></p>

<p>@ reads timestring, #@ universal time.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ADAY-BEFORE-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:DAY-BEFORE%20FUNCTION"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:DAY-BEFORE%20FUNCTION" >DAY-BEFORE</a></span></span> <span class="locative-args">DATE &amp;OPTIONAL (DAYS 1)</span></span></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40ALIST-UTILITIES-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@TIME-TOOLS%20MGL-PAX:SECTION" title="Time tools">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION" title="Anaphoric macros">&#8594;</a> <a href="#TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION" title="Alist utilities">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION">5 Alist utilities</a></h2>

<p>Add-hoc utilities for alist management.</p>

<p>Three operations on alists when they are used as key-value DB need to be defined:
- getting the value for key or nil (assocd),
- updating value for the key, unconditionally (update-alist)
- getting the value and updating it if it does not exist (get-or-update-alist)</p>

<p><a id="x-28TZ-UTILITIES-3AASSOCD-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:ASSOCD%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:ASSOCD%20FUNCTION" >ASSOCD</a></span></span> <span class="locative-args">ITEM ALIST &amp;REST PARS</span></span></p>

<p>Convenience shortcut for (cdr (assoc ...)), also known as alist-get in elisp.
FIXME: this must be in some standard library, but I can't find it.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AASSOCD-FOR-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:ASSOCD-FOR%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:ASSOCD-FOR%20FUNCTION" >ASSOCD-FOR</a></span></span> <span class="locative-args">KEY &amp;REST PARS</span></span></p>

<p>Function of one parameter (an alist) that extracts <code>KEY</code> from that alist</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ACLIST-TO-LLIST-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:CLIST-TO-LLIST%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:CLIST-TO-LLIST%20FUNCTION" >CLIST-TO-LLIST</a></span></span> <span class="locative-args">OBJECT</span></span></p>

<p>Convert list of conses (e.g., used by hunchentoot) to list of lists
(e.g., used for display in org mode).</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AGET-OR-UPDATE-ALIST-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:GET-OR-UPDATE-ALIST%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:GET-OR-UPDATE-ALIST%20MGL-PAX:MACRO" >GET-OR-UPDATE-ALIST</a></span></span> <span class="locative-args">(ALIST KEY &amp;REST ASSOC-PARS &amp;KEY &amp;ALLOW-OTHER-KEYS) &amp;BODY NEW-VAL-CODE</span></span></p>

<p>Get value associated with <code>KEY</code> in the <code>ALIST</code>; if it is not present,
update <code>ALIST</code> with <code>KEY</code> and evaluate <code>NEW-VAL-CODE</code> as new <code>VALUE</code>.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AWITH-SMALL-CACHE-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:WITH-SMALL-CACHE%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:WITH-SMALL-CACHE%20MGL-PAX:MACRO" >WITH-SMALL-CACHE</a></span></span> <span class="locative-args">(KEY &amp;REST PARS-TEST) &amp;BODY BODY</span></span></p>

<p>Return body, or it cached value. Caching is done on current and
cached <code>KEY</code>s being same; keyword parameters <code>KEY</code> and <code>TEST</code> can modify
what same means.</p>

<p>The cache is implemented as an alist, so should be small to keep efficiency.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3APRUNE-ALIST-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:PRUNE-ALIST%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:PRUNE-ALIST%20FUNCTION" >PRUNE-ALIST</a></span></span> <span class="locative-args">ALIST TEST</span></span></p>

<p>Remove duplicate entries from an alist.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AUPDATE-ALIST-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:UPDATE-ALIST%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:UPDATE-ALIST%20MGL-PAX:MACRO" >UPDATE-ALIST</a></span></span> <span class="locative-args">PLACE KEY NEW-VALUE &amp;REST TEST-PARS</span></span></p>

<p>Set value for <code>KEY</code> in modified alist to <code>NEW-VALUE</code></p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40ANAPHORIC-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@ALIST-UTILITIES%20MGL-PAX:SECTION" title="Alist utilities">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION" title="Named objects">&#8594;</a> <a href="#TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION" title="Anaphoric macros">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION">6 Anaphoric macros</a></h2>

<p>Anaphoric macros not defined in the Let-over-lambda package.</p>

<p><a id="x-28TZ-UTILITIES-3AAWHEN-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:AWHEN%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:AWHEN%20MGL-PAX:MACRO" >AWHEN</a></span></span> <span class="locative-args">TEST-FORM &amp;BODY BODY</span></span></p>

<p>Evaluate <code>TEST-FORM</code>, and if true, evaluate <code>BODY</code> with symbol <a href="#LET-OVER-LAMBDA:IT%20VARIABLE" title="LET-OVER-LAMBDA:IT VARIABLE"><code>IT</code></a> bound to its
value.</p></li>
</ul>

<p><a id="x-28LET-OVER-LAMBDA-3AIT-20VARIABLE-29"></a>
<a id="LET-OVER-LAMBDA:IT%20VARIABLE"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#LET-OVER-LAMBDA:IT%20VARIABLE" >IT</a></span></span></span></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40NAMED-OBJECTS-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@ANAPHORIC%20MGL-PAX:SECTION" title="Anaphoric macros">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@SAVE-LOAD`">&#8594;</a> <a href="#TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION" title="Named objects">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION">7 Named objects</a></h2>

<p>Class <a href="#TZ-UTILITIES:NAMED%20CLASS" title="TZ-UTILITIES:NAMED CLASS"><code>NAMED</code></a> streamlines creating &quot;printable&quot; named class instances.</p>

<p>Class <a href="#TZ-UTILITIES:NAMED-JSON%20CLASS" title="TZ-UTILITIES:NAMED-JSON CLASS"><code>NAMED-JSON</code></a> allows easier handling and pretty-printing of alist
objects. Word <code>JSON</code> in name is probably a bad one, but this is what I use it for:
alists obtained from cl-json:decode-json calls</p>

<p><a id="x-28TZ-UTILITIES-3ANAMED-20CLASS-29"></a>
<a id="TZ-UTILITIES:NAMED%20CLASS"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[class]</span> <span class="reference-object"><a href="#TZ-UTILITIES:NAMED%20CLASS" >NAMED</a></span></span></span></p>

<p>Use as a mixin/base class to ensure that the class has slot <code>NAME</code>. This slot is
used to pretty-print the objects.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AGET-NAME-20GENERIC-FUNCTION-29"></a>
<a id="TZ-UTILITIES:GET-NAME%20GENERIC-FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[generic-function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:GET-NAME%20GENERIC-FUNCTION" >GET-NAME</a></span></span> <span class="locative-args">OBJECT</span></span></p>

<p>Name of the object. If it is named object, value of the <code>NAME</code> slot, otherwise
object itself (suitable for strings, numbers, etc.)</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ANO-NAME-20CONDITION-29"></a>
<a id="TZ-UTILITIES:NO-NAME%20CONDITION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[condition]</span> <span class="reference-object"><a href="#TZ-UTILITIES:NO-NAME%20CONDITION" >NO-NAME</a></span></span> <span class="locative-args"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_seriou.htm" title="SERIOUS-CONDITION (MGL-PAX:CLHS CONDITION)">SERIOUS-CONDITION</a></span></span></p>

<p>Condition thrown when an object of class <a href="#TZ-UTILITIES:NAMED%20CLASS" title="TZ-UTILITIES:NAMED CLASS"><code>NAMED</code></a> has no <code>NAME</code> specified at
creation.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ANAMED-JSON-20CLASS-29"></a>
<a id="TZ-UTILITIES:NAMED-JSON%20CLASS"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[class]</span> <span class="reference-object"><a href="#TZ-UTILITIES:NAMED-JSON%20CLASS" >NAMED-JSON</a></span></span> <span class="locative-args"><a href="#TZ-UTILITIES:NAMED%20CLASS" title="TZ-UTILITIES:NAMED CLASS">NAMED</a></span></span></p>

<p>Objects backed up/created from an alist structure (e.g., decoded json) that
contains, among other, name/display name of the object.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AMAKE-JSON-OBJECT-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:MAKE-JSON-OBJECT%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:MAKE-JSON-OBJECT%20FUNCTION" >MAKE-JSON-OBJECT</a></span></span> <span class="locative-args">JSON CLASS &amp;REST PARS &amp;KEY (NAME-KEYWORD <code>:NAME</code>) (NAME-FN (<a href="#TZ-UTILITIES:ASSOCD-FOR%20FUNCTION" title="TZ-UTILITIES:ASSOCD-FOR FUNCTION"><code>ASSOCD-FOR</code></a> <code>NAME-KEYWORD</code>)) &amp;ALLOW-OTHER-KEYS</span></span></p>

<p>Make instance of an object backed by an alist. Typically, sets name based on
the value associated with <code>NAME-KEYWORD</code>, but another function to extract name can
be specified with NAMED-FN.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AMAKE-JSON-OBJECTS-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:MAKE-JSON-OBJECTS%20FUNCTION"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:MAKE-JSON-OBJECTS%20FUNCTION" >MAKE-JSON-OBJECTS</a></span></span> <span class="locative-args">LIST-OF-JSON &amp;REST PARS</span></span></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40SAVE-LOAD-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@NAMED-OBJECTS%20MGL-PAX:SECTION" title="Named objects">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@JS-TOOLS`">&#8594;</a> <a href="#TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@SAVE-LOAD`">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION">8 <code>@SAVE-LOAD</code></a></h2>

<p>To preserve relatively stable data across run of the system, the
actual values of the variables can be saved and then loaded on
startup (or anytime else).</p>

<p>The data are saved to a define directory with names created from the
provided string and timestamp; loading is done from the most recent
(based on name) file.</p>

<p>The background mechanism for storing is cl-store.</p>

<p>Typical sequence is
<code>
(defvar *A-VARIABLE* (load-value &quot;foo&quot;))
...
;;; some long calculation to update *A-VARIABLE*
...
(save-value *A-VARIABLE* &quot;foo&quot;)
</code></p>

<p><a id="x-28TZ-UTILITIES-3ASAVE-VALUE-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:SAVE-VALUE%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:SAVE-VALUE%20FUNCTION" >SAVE-VALUE</a></span></span> <span class="locative-args">VALUE BASE-NAME &amp;KEY (CACHE-PATH <a href="#TZ-UTILITIES:*DEFAULT-CACHE-PATH*%20VARIABLE" title="TZ-UTILITIES:*DEFAULT-CACHE-PATH* VARIABLE"><code>*DEFAULT-CACHE-PATH*</code></a>)</span></span></p>

<p>Store value to a timestamped storage in cache.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3ALOAD-VALUE-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:LOAD-VALUE%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:LOAD-VALUE%20FUNCTION" >LOAD-VALUE</a></span></span> <span class="locative-args">BASE-NAME &amp;KEY (CACHE-PATH <a href="#TZ-UTILITIES:*DEFAULT-CACHE-PATH*%20VARIABLE" title="TZ-UTILITIES:*DEFAULT-CACHE-PATH* VARIABLE"><code>*DEFAULT-CACHE-PATH*</code></a>)</span></span></p>

<p>Load value keyed by <code>BASE-NAME</code> from the most recent file (by name) in cache.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-2ADEFAULT-CACHE-PATH-2A-20VARIABLE-29"></a>
<a id="TZ-UTILITIES:*DEFAULT-CACHE-PATH*%20VARIABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#TZ-UTILITIES:*DEFAULT-CACHE-PATH*%20VARIABLE" >*DEFAULT-CACHE-PATH*</a></span></span> <span class="locative-args">&quot;~/.cache/lisp/&quot;</span></span></p>

<p>Default directory to save the variable values.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40JS-TOOLS-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@SAVE-LOAD%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@SAVE-LOAD`">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@DEBUGGER-HOOKS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@DEBUGGER-HOOKS`">&#8594;</a> <a href="#TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@JS-TOOLS`">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION">9 <code>@JS-TOOLS</code></a></h2>

<p>Function on lists that facilitate work with json data after parsing
them with cl-json. See also LET-ALIST.</p>

<p><a id="x-28TZ-UTILITIES-3AEXTRACT-TAGS-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:EXTRACT-TAGS%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:EXTRACT-TAGS%20FUNCTION" >EXTRACT-TAGS</a></span></span> <span class="locative-args">ALIST TAG-SPECS</span></span></p>

<p>Extracts values in the <code>ALIST</code> matching keys in <code>TAG-SPECS</code>, optionally applying a
function specified in <code>TAG-SPECS</code>.</p>

<p><code>TAG-SPECS</code> is a list where each element is either a <code>KEY</code> or list (<code>KEY</code> FN).</p>

<p>Example:
: (extract-tags '((:foo . 1) (:bar 2) (:baz 3)) '(:baz (:foo 1-)))
gives
: ((3) 0)</p>

<p>Maybe LET-ALIST is more natural interface in many cases.</p>

<p>Not optimized for speed:
- iterates tags-specs twice
- conses a lot
- etc.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AEXTRACT-TAGS-FROM-LIST-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:EXTRACT-TAGS-FROM-LIST%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:EXTRACT-TAGS-FROM-LIST%20FUNCTION" >EXTRACT-TAGS-FROM-LIST</a></span></span> <span class="locative-args">TAGS DATA</span></span></p>

<p><a href="#TZ-UTILITIES:EXTRACT-TAGS%20FUNCTION" title="TZ-UTILITIES:EXTRACT-TAGS FUNCTION"><code>EXTRACT-TAGS</code></a> on each item in list <code>DATA</code>.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AFILL-TEMPLATE-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:FILL-TEMPLATE%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:FILL-TEMPLATE%20FUNCTION" >FILL-TEMPLATE</a></span></span> <span class="locative-args">TEMPLATE KEYS-VALUES</span></span></p>

<p>Fill a template suitable for json with values.</p>

<p>Return a copy of template with each cons that starts with a <code>KEY</code> from
<code>KEYS-VALUES</code> plist has its cdr replaced with the appropriate <code>VALUE</code>.</p>

<p>Example:
: (fill-template '(Here is a (:value &quot;To be filled&quot;))  ((:value 42)))
gives
: (HERE IS A (<code>:VALUE</code> . 42))</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AFILL-TEMPLATE-2A-20FUNCTION-29"></a>
<a id="TZ-UTILITIES:FILL-TEMPLATE*%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#TZ-UTILITIES:FILL-TEMPLATE*%20FUNCTION" >FILL-TEMPLATE*</a></span></span> <span class="locative-args">TEMPLATE &amp;REST KEYS-VALUES</span></span></p>

<p>Same as <a href="#TZ-UTILITIES:FILL-TEMPLATE%20FUNCTION" title="TZ-UTILITIES:FILL-TEMPLATE FUNCTION"><code>FILL-TEMPLATE</code></a>, but with <code>KEYS-VALUES</code> as call parameters.</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3AJSON-BASED-SIMPLE-20CLASS-29"></a>
<a id="TZ-UTILITIES:JSON-BASED-SIMPLE%20CLASS"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[class]</span> <span class="reference-object"><a href="#TZ-UTILITIES:JSON-BASED-SIMPLE%20CLASS" >JSON-BASED-SIMPLE</a></span></span></span></p>

<p>A class that can be initiated from <code>JSON</code> data. There are two additional initargs,
:slot-map and :json, that maps json path and slot name. Each of keywords in SLOT-MAP is
sought by <code>ALIST</code> in the <code>JSON</code> and if present, both are added to the initargs.</p>

<p>The <code>JSON</code> can be also a slot, of course. And <code>:SLOT-MAP</code> can be in the default-initargs.</p>

<p>Example: define a derived class,
: (defclass json-example (json-based-simple)
:  ((foo :accessor get-foo :initarg :foo)
:   (bar :accessor get-bar :initarg :bar)))</p>

<p>and then use
: (make-instance 'json-example :slot-map
:      '(:foo :bar) :json '(:foo 12))</p></li>
</ul>

<p><a id="x-28TZ-UTILITIES-3A-40DEBUGGER-HOOKS-20MGL-PAX-3ASECTION-29"></a>
<a id="TZ-UTILITIES:@DEBUGGER-HOOKS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#TZ-UTILITIES:@JS-TOOLS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@JS-TOOLS`">&#8592;</a> <a href="index.html" title="`TZ-UTILITIES::@INDEX`">&#8593;</a> <a href="#TZ-UTILITIES:@DEBUGGER-HOOKS%20MGL-PAX:SECTION" title="`TZ-UTILITIES::@DEBUGGER-HOOKS`">&#8634;</a></span></span></p>

<h2><a href="#TZ-UTILITIES:@DEBUGGER-HOOKS%20MGL-PAX:SECTION">10 <code>@DEBUGGER-HOOKS</code></a></h2>

<p><a href="#TZ-UTILITIES:MAKE-CASCADED-DEBUGGER-HOOK%20MGL-PAX:MACRO" title="TZ-UTILITIES:MAKE-CASCADED-DEBUGGER-HOOK MGL-PAX:MACRO"><code>MAKE-CASCADED-DEBUGGER-HOOK</code></a> is used to add additional handler cases for current repl.</p>

<p>This is probably not good idea to use and fully experimental.</p>

<p><a id="x-28TZ-UTILITIES-3AMAKE-CASCADED-DEBUGGER-HOOK-20MGL-PAX-3AMACRO-29"></a>
<a id="TZ-UTILITIES:MAKE-CASCADED-DEBUGGER-HOOK%20MGL-PAX:MACRO"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[macro]</span> <span class="reference-object"><a href="#TZ-UTILITIES:MAKE-CASCADED-DEBUGGER-HOOK%20MGL-PAX:MACRO" >MAKE-CASCADED-DEBUGGER-HOOK</a></span></span> <span class="locative-args">CASES</span></span></p>

<p>A function suitable for the debugger hook that checks <code>CASES</code> (same format as in
 handler-case) and if none matches, runs whatever was the hook when it was called.</p>

<p>Usage:
: (setq <em>debugger-hook</em>
:    (make-cascaded-debugger-hook '((simple-error continue)))))</p></li>
</ul>
  </div>
</div>
<script>$('#page-toc').toc({'selectors': 'h1,h2,h3,h4'});</script>
</body>
</html>
